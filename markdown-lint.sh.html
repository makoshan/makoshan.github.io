<div class="sourceCode" id="cb1"><pre class="sourceCode Bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># When:  Time-stamp: &quot;2021-06-29 13:07:09 gwern&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># see https://www.gwern.net/About#markdown-checker</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> +x</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># function to wrap checks and print highlighted warning if non-zero output (self-documenting):</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap()</span> <span class="kw">{</span> <span class="va">OUTPUT</span><span class="op">=</span><span class="va">$($1</span> <span class="dv">2</span><span class="op">&gt;&amp;</span>1<span class="va">)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>         <span class="va">WARN</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$2</span><span class="st">&quot;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-n</span> <span class="st">&quot;</span><span class="va">$OUTPUT</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>             <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\e[41m</span><span class="va">$WARN</span><span class="st">\e[0m&quot;</span>:</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>             <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">$OUTPUT</span><span class="st">&quot;</span><span class="kw">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>         <span class="cf">fi</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">fgp ()</span> <span class="kw">{</span> <span class="fu">grep</span> <span class="at">-F</span> <span class="at">--context</span><span class="op">=</span>1 <span class="at">--line-number</span> <span class="at">--color</span><span class="op">=</span>always <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">egp ()</span> <span class="kw">{</span> <span class="fu">grep</span> <span class="at">-E</span> <span class="at">--ignore-case</span> <span class="at">--context</span><span class="op">=</span>1 <span class="at">--line-number</span> <span class="at">--color</span><span class="op">=</span>always <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> PAGE <span class="kw">in</span> <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="va">$PAGE</span> <span class="ot">==</span> <span class="pp">*</span>.page <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="fu">file</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">fgp</span> <span class="at">--invert-match</span> <span class="st">&#39;text&#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Not text, perhaps due to bad copy-paste&quot;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">egp</span> <span class="st">&#39;[^[:print:]]&#39;</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;File contains unprintable characters&quot;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">fgp</span> <span class="at">-e</span> <span class="st">&#39;http://dl.dropbox&#39;</span> <span class="at">-e</span> <span class="st">&#39;.wiley.com/doi/abs/&#39;</span>  <span class="dt">\</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;www.tandfonline.com/doi/abs/&#39;</span> <span class="at">-e</span> <span class="st">&#39;jstor.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;springer.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;springerlink.com&#39;</span> <span class="dt">\</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;www.mendeley.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;academia.edu&#39;</span> <span class="at">-e</span> <span class="st">&#39;researchgate.net&#39;</span> <span class="at">-e</span> <span class="st">&#39;pdf.yt&#39;</span> <span class="dt">\</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;photobucket&#39;</span> <span class="at">-e</span> <span class="st">&#39;imgur.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;hathitrust.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;emilkirkegaard.dk&#39;</span> <span class="at">-e</span> <span class="st">&#39;arthurjensen.net&#39;</span> <span class="dt">\</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;humanvarieties.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;libgen.io/&#39;</span> <span class="at">-e</span> <span class="st">&#39;gen.lib.rus.ec/&#39;</span> <span class="at">-e</span> <span class="st">&#39;sci-hub.bz/&#39;</span> <span class="at">-e</span> <span class="st">&#39;](http://www.scilogs.com/&#39;</span> <span class="dt">\</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;sci-hub.cc/&#39;</span> <span class="at">-e</span> <span class="st">&quot;papers.nber.org/&quot;</span> <span class="at">-e</span> <span class="st">&#39;](!wikipedia&#39;</span> <span class="at">-e</span> <span class="st">&#39;](!wikipedia)&#39;&quot;&#39;s&quot;</span> <span class="at">-e</span> <span class="st">&#39;https://wwww.&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://wwww.&#39;</span> <span class="dt">\</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;http://33bits.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;https://gwern.net&#39;</span> <span class="at">-e</span> <span class="st">&#39;https://gwern.net&#39;</span> <span class="at">-e</span> <span class="st">&#39;web.archive.org/web/2&#39;</span> <span class="dt">\</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;webarchive.org.uk/wayback/&#39;</span> <span class="at">-e</span> <span class="st">&#39;webcitation.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;plus.google.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;www.deepdotweb.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;raikoth.net&#39;</span> <span class="dt">\</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;drive.google.com/file&#39;</span> <span class="at">-e</span> <span class="st">&#39;ssrn.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;ardenm.us&#39;</span> <span class="at">-e</span> <span class="st">&#39;gnxp.nofe.me&#39;</span> <span class="at">-e</span> <span class="st">&#39;psycnet.apa.org&#39;</span> <span class="dt">\</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;wellcomelibrary.org/item/&#39;</span> <span class="at">-e</span> <span class="st">&#39;dlcs.io/pdf/&#39;</span> <span class="at">-e</span> <span class="st">&#39;secure.wikimedia.org&#39;</span> <span class="dt">\</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;https://biorxiv.org&#39;</span> <span class="dt">\</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;fbclid=&#39;</span> <span class="at">-e</span> <span class="st">&#39;?gid=&#39;</span> <span class="at">-e</span> <span class="st">&#39;twitter.com/#!&#39;</span> <span class="at">-e</span> <span class="st">&#39;pay.reddit.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;europepmc.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;drugcite.com&#39;</span> <span class="dt">\</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;guardian.co.uk&#39;</span> <span class="at">-e</span> <span class="st">&#39;mlp.wikia.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;฿&#39;</span> <span class="at">-e</span> <span class="st">&#39;!Wikipedia &quot;&quot;&#39;</span> <span class="at">-e</span> <span class="st">&#39;medium.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;temcauley.staff.shef.ac.uk&#39;</span> <span class="dt">\</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;yahoo.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;bloomberg.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;.wsj.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;extremelongevity.net&#39;</span> <span class="at">-e</span> <span class="st">&#39;blog.openai.com&#39;</span> <span class="dt">\</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;https://ww.gwern.net&#39;</span> <span class="at">-e</span> <span class="st">&#39;https://w.gwern.net&#39;</span> <span class="at">-e</span> <span class="st">&#39;www.heretical.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;books.google.ca&#39;</span> <span class="dt">\</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;lesserwrong.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;au.news.yahoo.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;northjersey.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;tribune.com.pk&#39;</span> <span class="at">-e</span> <span class="st">&#39;idsnews.com&#39;</span> <span class="dt">\</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;catsensebook.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;whec.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;www.mercurynews.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;meetup.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;www.reddit.com&#39;</span> <span class="dt">\</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;dlcs.io/&#39;</span> <span class="at">-e</span> <span class="st">&#39;centerforcollegeaffordability.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;quora.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;times-news.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;www.cebp.nl&#39;</span> <span class="dt">\</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;#filmtv&#39;</span> <span class="at">-e</span> <span class="st">&#39;nybooks.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;div id=&quot;columns&quot;&gt;&#39;</span> <span class="at">-e</span> <span class="st">&#39;annualreviews.org&#39;</span> <span class="dt">\</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;dspace.mit.edu&#39;</span> <span class="at">-e</span> <span class="st">&#39;shirky.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;](http://www.nzherald.co.nz)&#39;</span> <span class="at">-e</span> <span class="st">&#39;https://www.arxiv.org&#39;</span> <span class="dt">\</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;goodreads.com/review/show&#39;</span> <span class="at">-e</span> <span class="st">&#39;myanimelist.net/reviews.php?id=&#39;</span>  <span class="dt">\</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;cloudfront.net&#39;</span> <span class="at">-e</span> <span class="st">&#39;https://www.amazon.com/s?ie=UTF8&amp;field-isbn=&amp;page=1&amp;rh=i:stripbooks&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://ltimmelduchamp.com&#39;</span> <span class="dt">\</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;thiswaifudoesnotexist.net)&#39;</span> <span class="at">-e</span> <span class="st">&#39;thiswaifudoesnotexist.net&quot;&#39;</span> <span class="at">-e</span> <span class="st">&#39;www.wikilivres.ca&#39;</span> <span class="at">-e</span> <span class="st">&#39;worldtracker.org&#39;</span> <span class="dt">\</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;meaningness.wordpress.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;ibooksonline.com&#39;</span> <span class="at">-e</span> tinypic.com <span class="at">-e</span> isteve.com <span class="at">-e</span> <span class="st">&#39;j-bradford-delong.net&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>           <span class="ex">egp</span> <span class="at">-e</span> <span class="st">&#39;https://arxiv.org/abs/[0-9]\{4\}\.[0-9]\+v[0-9]&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;}</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;find bad URLS, unacceptable/unreliable/risky domains, malformed syntax, unmatched apostrophes&quot;</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">fgp</span>  <span class="at">-e</span> <span class="st">&#39;http://news.ycombinator.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://github.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://www.ncbi.nlm.nih.gov/pubmed/&#39;</span> <span class="dt">\</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;http://www.coursera.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://en.wikipedia.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://biorxiv.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://www.biorxiv.org&#39;</span> <span class="dt">\</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;http://arxiv.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://slatestarcodex.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://arxiv.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://www.arxiv.org&#39;</span> <span class="dt">\</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;http://myanimelist.net&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://www.bmj.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://www.youtube.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://youtu.be&#39;</span> <span class="at">-e</span> <span class="st">&quot;http://www.nature.com/&quot;</span> <span class="dt">\</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&quot;http://www.sciencedirect.com&quot;</span> <span class="at">-e</span> <span class="st">&quot;http://journals.plos.org&quot;</span> <span class="at">-e</span> <span class="st">&quot;http://www.pnas.org&quot;</span> <span class="at">-e</span> <span class="st">&quot;http://www.wsj.com&quot;</span> <span class="dt">\</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&quot;http://link.springer.com&quot;</span> <span class="at">-e</span> <span class="st">&quot;http://www.bbc.com&quot;</span> <span class="at">-e</span> <span class="st">&quot;http://genomebiology.biomedcentral.com&quot;</span> <span class="at">-e</span> <span class="st">&quot;http://www.npr.org&quot;</span> <span class="dt">\</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&quot;http://www.ipscell.com&quot;</span> <span class="at">-e</span> <span class="st">&quot;http://www.newyorker.com&quot;</span> <span class="at">-e</span> <span class="st">&quot;http://www.nytimes.com&quot;</span> <span class="at">-e</span> <span class="st">&#39;http://ask.metafilter.com&#39;</span> <span class="dt">\</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;http://www.metafilter.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://www.vanityfair.com&#39;</span> <span class="at">-e</span>  <span class="st">&#39;http://econlog.econlib.org&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://www.overcomingbias.com&#39;</span> <span class="dt">\</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;http://www.economist.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://www.theverge.com&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;HTTP → HTTPS URLs&quot;</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>        <span class="co">## ban articles written by John Hewitt; he endorses the pig-human pseudoscience, lies about research (eg claiming platypus genome proven to be a bird hybrid), and makes bad arguments (eg his criticism of senolytics because senescent cells do not have a single unique universal signature):</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="fu">fgrep</span> <span class="at">-e</span> <span class="st">&#39;phys.org&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">fgp</span> <span class="at">-v</span> <span class="at">-e</span> <span class="st">&#39;2019-07-cat-science.html&#39;</span> <span class="at">-e</span> <span class="st">&#39;2017-08-cavemen-genetic-checkup.html&#39;</span> <span class="at">-e</span><span class="st">&#39;2019-12-mouse-pups-born-eggs-derived.html&#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Phys.org link detected: make sure John Hewitt didn&#39;t write it&quot;</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">~/wiki/static/build/Columns.hs</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Add columns wrapper?&quot;</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">runhaskell</span> <span class="at">-i</span>/home/gwern/wiki/static/build/ ~/wiki/static/build/link-extractor.hs <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">egp</span> <span class="at">--only-matching</span> <span class="at">-e</span> <span class="st">&#39;^http://.*archive\.org/.*\.pdf$&#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;check for aggregator-hosted PDFs and host them on Gwern.net to make them visible to Google Scholar/provide backups&quot;</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">runhaskell</span> <span class="at">-i</span>/home/gwern/wiki/static/build/ ~/wiki/static/build/link-extractor.hs <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">egp</span> <span class="at">--only-matching</span> <span class="at">-e</span> <span class="st">&#39;^http://twitter.com/&#39;</span> <span class="at">-e</span> <span class="st">&#39;https://.*twitter.com/.+/status/[0-9]+&#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Switch Twitter.com to Nitter.net links&quot;</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">egp</span> <span class="at">-e</span> <span class="st">&#39;http://www.pnas.org/content/.*/.*/.*.abstract&#39;</span> <span class="at">-e</span> <span class="st">&#39;[^\.]t\.test\(&#39;</span> <span class="at">-e</span> <span class="st">&#39;^\~\~\{\.&#39;</span> <span class="dt">\</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;ncbi.nlm.nih.gov/pubmed/[[:digit:]][[:digit:]]*&#39;</span> <span class="dt">\</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;biorxiv.org/content/biorxiv/.*\.pdf &#39;</span> <span class="at">-e</span> <span class="st">&#39;(https://www.biorxiv.org/content/biorxiv/.*\.pdf)&#39;</span> <span class="dt">\</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;arxiv.org/pdf/.*\.pdf)&#39;</span> <span class="at">-e</span> <span class="st">&#39;arxiv.org/pdf/.*\.pdf &quot;&#39;</span>  <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;if I am not linking a specific page on Arxiv or BioRxiv, why am I linking to the PDF rather than the landing page?&quot;</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">fgp</span> <span class="at">-e</span> <span class="st">&quot;.pdf#subsection&quot;</span> <span class="at">-e</span> <span class="st">&quot;.pdf#Appendix&quot;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Section PDF links break when archived locally (thereby breaking the local-PDF popups), so avoid unusual anchors in favor of &#39;page=N&#39; anchor links&quot;</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="ex">egp</span> <span class="at">-e</span> <span class="st">&#39;&lt;div id=&quot;abstract&quot;&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;div id=&quot;collapseSummary&quot;&#39;</span> <span class="at">-e</span> <span class="st">&#39;^&lt;/div$&#39;</span> <span class="at">-e</span> <span class="st">&#39;^\[\!Margin: &#39;</span> <span class="at">-e</span> <span class="st">&#39; n=[[:digit:]]&#39;</span> <span class="at">-e</span> <span class="st">&#39; n = [[:digit:]]&#39;</span> <span class="dt">\</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;]\(/.*#fn[[:digit:]]&#39;</span> <span class="at">-e</span> <span class="st">&#39;[0-9]\.[0-9]*⁄&#39;</span> <span class="at">-e</span> <span class="st">&#39;^\.&gt;&#39;</span> <span class="dt">\</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;cssExtension: [a-c,e-z]&#39;</span> <span class="at">-e</span> <span class="st">&#39;^R&gt; &#39;</span> <span class="at">-e</span> <span class="st">&#39;^#+ Comments$&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>              <span class="ex">fgp</span> <span class="at">-e</span> <span class="st">&#39;(www&#39;</span> <span class="at">-e</span> <span class="st">&#39;)www&#39;</span> <span class="at">-e</span> <span class="st">&#39;![](&#39;</span> <span class="at">-e</span> <span class="st">&#39;]()&#39;</span> <span class="at">-e</span> <span class="st">&#39; )&#39;</span> <span class="at">-e</span> <span class="st">&#39;](//&#39;</span> <span class="at">-e</span> <span class="st">&#39;](/wiki/&#39;</span> <span class="at">-e</span> <span class="st">&#39;](wiki/&#39;</span> <span class="at">-e</span> <span class="st">&#39;——–&#39;</span> <span class="at">-e</span> <span class="st">&#39;——&#39;</span> <span class="at">-e</span> <span class="st">&#39;————–&#39;</span> <span class="at">-e</span> <span class="st">&#39; --- &#39;</span> <span class="dt">\</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39; percent &#39;</span> <span class="at">-e</span> <span class="st">&quot;    Pearson&#39;&quot;</span> <span class="at">-e</span> <span class="st">&#39;~~~{.sh}&#39;</span> <span class="at">-e</span> <span class="st">&#39;library(&quot;&#39;</span> <span class="at">-e</span> <span class="st">&#39; +-&#39;</span> <span class="at">-e</span> <span class="st">&#39; -+&#39;</span> <span class="at">-e</span> <span class="st">&#39;&quot;collapse Summary&quot;&#39;</span> <span class="at">-e</span> <span class="st">&#39;&quot;CollapseSummary&quot;&#39;</span> <span class="at">-e</span> <span class="st">&#39;collapseSumary&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;!_-&#39;</span> <span class="at">-e</span> <span class="st">&#39; bu &#39;</span> <span class="dt">\</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;]{.dropcaps}&#39;</span> <span class="at">-e</span> <span class="st">&#39;{,smallcaps}&#39;</span> <span class="at">-e</span> <span class="st">&#39;[.smallcaps}&#39;</span> <span class="at">-e</span> <span class="st">&#39;[PMC]{.smallcaps}&#39;</span> <span class="at">-e</span> <span class="st">&#39;nsheppard&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;div class-&#39;</span> <span class="dt">\</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;^ &gt; [a-Z]&#39;</span> <span class="at">-e</span> <span class="st">&#39;^  &gt; [a-Z]&#39;</span> <span class="at">-e</span> <span class="st">&#39;^   &gt; [a-Z]&#39;</span> <span class="at">-e</span> <span class="st">&#39;^  - [a-Z]&#39;</span> <span class="at">-e</span> <span class="st">&#39;^   - [a-Z]&#39;</span> <span class="dt">\</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;&lt;p class=&quot;drop-cap&#39;</span> <span class="at">-e</span> <span class="st">&#39;class=&quot;drop-caps-&#39;</span> <span class="at">-e</span> <span class="st">&#39; n_=&#39;</span> <span class="at">-e</span> <span class="st">&#39;~~~{.collape}&#39;</span> <span class="at">-e</span> <span class="st">&#39;~~~~&#39;</span> <span class="at">-e</span> <span class="st">&#39;{.fullwidth}&#39;</span> <span class="at">-e</span> <span class="st">&#39;Wikiepdia&#39;</span> <span class="at">-e</span> <span class="st">&#39;Wikipdia&#39;</span> <span class="at">-e</span> <span class="st">&#39;/docs/genetic/&#39;</span> <span class="dt">\</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;&quot; ](&#39;</span> <span class="at">-e</span> <span class="st">&#39;!Marin:&#39;</span> <span class="at">-e</span> <span class="st">&#39;](images/&#39;</span> <span class="at">-e</span> <span class="st">&#39;\Mathcal{&#39;</span> <span class="at">-e</span> <span class="st">&quot;&#39;&#39;&quot;</span> <span class="at">-e</span> <span class="st">&#39;``&#39;</span> <span class="at">-e</span> <span class="st">&#39; &quot; &#39;</span> <span class="at">-e</span> <span class="st">&#39;\mathcal{O}(log&#39;</span> <span class="at">-e</span> <span class="st">&#39;preload=&quot;metadata&quot;&#39;</span> <span class="dt">\</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>                  <span class="at">-e</span> <span class="st">&#39;#close&#39;</span> <span class="at">-e</span> <span class="st">&#39;#page=page&#39;</span> <span class="at">-e</span> <span class="st">&#39;.pdf#section&#39;</span> <span class="at">-e</span> <span class="st">&#39;.pdf#subsection&#39;</span> <span class="at">-e</span> <span class="st">&#39;^&lt;sup&gt;&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;sup&gt;^&#39;</span> <span class="at">-e</span> <span class="st">&#39;^&lt;/sup&gt;&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;/sup&gt;^&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;look for broken syntax in original Markdown: (NOTE: footnotes should not be linked to because they are unstable; they should either be sections/appendices, or given a long-term div ID)&quot;</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="fu">grep</span> <span class="at">--perl-regexp</span> <span class="at">--null-data</span> <span class="at">--only-matching</span> <span class="st">&#39;(?s)\n\&lt;\/div\&gt;\n\n\^\[\!Margin: .....&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Margin note possibly breaks drop caps by being first item on the first line after an abstract&quot;</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="fu">grep</span> <span class="at">-P</span> <span class="at">-e</span> <span class="st">&#39;[\x{0590}-\x{05FF}]|[\x{0600}-\x{06FF}]&#39;</span>  <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Check that bidirectional scripts (Hebrew, Arabic) are not displayed; can cause Firefox Mac rendering bugs page-wide&quot;</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="fu">fgrep</span> <span class="st">&#39;~~~{.&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="at">-d</span> <span class="st">&#39;{}~&#39;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39; &#39;</span> <span class="st">&#39;\n&#39;</span> <span class="kw">|</span> <span class="dt">\</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">fgrep</span> <span class="at">-v</span> <span class="at">-e</span> <span class="st">&#39;.R&#39;</span> <span class="at">-e</span> <span class="st">&#39;.collapse&#39;</span> <span class="at">-e</span> <span class="st">&#39;.Haskell&#39;</span> <span class="at">-e</span> <span class="st">&#39;.Bash&#39;</span> <span class="at">-e</span> <span class="st">&#39;.Diff&#39;</span> <span class="at">-e</span> <span class="st">&#39;.Javascript&#39;</span> <span class="at">-e</span> <span class="st">&#39;.numberLines&#39;</span> <span class="dt">\</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>                       <span class="at">-e</span> <span class="st">&#39;.Python&#39;</span> <span class="at">-e</span> <span class="st">&#39;.C &#39;</span> <span class="at">-e</span> <span class="st">&#39;.CPO&#39;</span> <span class="at">-e</span> <span class="st">&#39;.SQL&#39;</span> <span class="at">-e</span> <span class="st">&#39;.Bibtex&#39;</span> <span class="at">-e</span> <span class="st">&#39;.HTML&#39;</span> <span class="at">-e</span> <span class="st">&#39;.CSS&#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;look for potentially broken syntax-highlighting classes&quot;</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="fu">egrep</span> <span class="at">--invert-match</span> <span class="st">&#39;[[:space:]]*&gt;&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">fgp</span> <span class="at">-e</span> <span class="st">&#39; significant &#39;</span> <span class="at">-e</span> <span class="st">&#39; significantly &#39;</span> <span class="at">-e</span> <span class="st">&#39; obvious&#39;</span> <span class="at">-e</span> <span class="st">&#39;basically&#39;</span> <span class="at">-e</span> <span class="st">&#39; the the &#39;</span> <span class="at">-e</span> <span class="st">&#39;reproducibility crisis&#39;</span> <span class="at">-e</span> <span class="st">&#39;replicability crisis&#39;</span><span class="kw">;</span> <span class="kw">}</span> <span class="co"># </span><span class="al">WARNING</span><span class="co">: can&#39;t use &#39;egp&#39; for some reason</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;look for personal uses of illegitimate statistics &amp; weasel words, but filter out blockquotes&quot;</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">fgp</span> <span class="at">-e</span> <span class="st">&#39; feet&#39;</span> <span class="at">-e</span> <span class="st">&#39; foot &#39;</span> <span class="at">-e</span> <span class="st">&#39; pound &#39;</span> <span class="at">-e</span> <span class="st">&#39; mile &#39;</span> <span class="at">-e</span> <span class="st">&#39; miles &#39;</span> <span class="at">-e</span> <span class="st">&#39; inch&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>             <span class="ex">egp</span> <span class="at">-e</span> <span class="st">&#39;[0-9][0-9]* \(January\|February\|March\|April\|May\|June\|July\|August\|September\|October\|November\|December\) [0-9][0-9][0-9][0-9]&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;look for English/imperial units as a reminder to switch to metric as much as possible&quot;</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="fu">grep</span> <span class="at">-E</span> <span class="at">--only-matching</span> <span class="st">&#39;^\[\^.*\]: &#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">|</span> <span class="fu">uniq</span> <span class="at">--count</span> <span class="kw">|</span> <span class="dt">\</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">grep</span> <span class="at">-F</span> <span class="at">--invert-match</span> <span class="st">&#39;      1 [^&#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;check for duplicate footnote IDs (force no highlighting, because the terminal escape codes trigger bracket-matching)&quot;</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">egp</span> <span class="at">--only-matching</span> <span class="st">&#39;\!\[.*\]\(wiki/.*\)&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;indicates broken copy-paste of image location&quot;</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="fu">grep</span> <span class="at">--perl-regexp</span> <span class="at">--null</span> <span class="at">--only-matching</span> <span class="at">-e</span> <span class="st">&#39;\!\[.*\]\(.*\)\n\!\[.*\]\(.*\)&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;look for images used without newline in between them; in some situations, this leads to odd distortions of aspect ratio/zooming or something (first discovered in Correlation.page in blockquotes)&quot;</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">egp</span> <span class="st">&#39;^[^$]* [^\&quot;]\$[^$]*$&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;look for unescaped single dollar-signs (risk of future breakage)&quot;</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">egp</span> <span class="at">-e</span> <span class="st">&#39;[a-zA-Z]- &#39;</span>  <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Write out shortcuts&quot;</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">fgp</span> <span class="at">-e</span> <span class="st">&#39;= ~&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">fgp</span> <span class="at">--invert-match</span> <span class="st">&#39; mods&#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Unicodify: instead of writing &#39;x = ~y&#39;, unicode as &#39;≈&#39;&quot;</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">fgp</span> <span class="at">-e</span> <span class="st">&#39;?!&#39;</span> <span class="at">-e</span> <span class="st">&#39;!?&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;-&gt;&#39;</span> <span class="at">-e</span> <span class="st">&#39;~&gt;&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Unicodify: misc&quot;</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">egp</span> <span class="at">-e</span> <span class="st">&#39;[[:alnum:]]≠[[:alnum:]]&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Unicodify: != renders better with spaces around it&quot;</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">egp</span> <span class="at">-e</span> <span class="st">&#39;\$[[:alnum:]]\$&#39;</span> <span class="at">-e</span> <span class="st">&#39;\$\\sqrt{[[:digit:]]}\$&#39;</span> <span class="at">-e</span> <span class="st">&#39;\$[[:alnum:]]^[[:alnum:]]\$&#39;</span> <span class="at">-e</span> <span class="st">&#39;\$[[:alnum:]]+ \cdot [[:alnum:]]+\$&#39;</span> <span class="at">-e</span> <span class="st">&#39;\$[[:alnum:]]\$&#39;</span> <span class="dt">\</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;\$\\sqrt{[[:digit:]]}\$&#39;</span> <span class="at">-e</span> <span class="st">&#39;\$log_2\$&#39;</span> <span class="at">-e</span> <span class="st">&#39;\$log_10\$&#39;</span> <span class="at">-e</span> <span class="st">&#39;\$\\mathcal{N}&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;LaTeX: simplify to Unicode/Markdown&quot;</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">egp</span> <span class="at">-e</span> <span class="st">&#39;\$\\frac{[0-9]\+}{[0-9]\+}&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Unicodify: LaTeX for simple numerical fractions is overkill; use &#39;⁄&#39; FRACTION SLASH instead&quot;</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="fu">fgrep</span> <span class="st">&#39; \\times &#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;LaTeX: </span><span class="dt">\\</span><span class="st">cdot is nicer&quot;</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="fu">fgrep</span> <span class="st">&#39;$$E(&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;LaTeX: use </span><span class="dt">\\</span><span class="st">mathbb for expectations&quot;</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">egp</span> <span class="at">-e</span> <span class="st">&#39;[a-zA-Z]→[a-zA-Z]&#39;</span> <span class="at">-e</span> <span class="st">&#39;[a-zA-Z]←[a-zA-Z]&#39;</span> <span class="at">-e</span> <span class="st">&#39;[a-zA-Z]↔[a-zA-Z]&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Add spaces to arrows: more legible, fewer odd interactions (like Hyphenator)&quot;</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">fgp</span> <span class="at">-i</span> <span class="at">-e</span> <span class="st">&#39;&lt;div class=&quot;admonition-warning&quot;&gt;&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;div class=&quot;admonition-note&quot;&gt;&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;div class=&quot;admonition-error&quot;&gt;&#39;</span> <span class="dt">\</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-e</span> <span class="st">&#39;**Warn&#39;</span> <span class="at">-e</span> <span class="st">&#39;**Note&#39;</span> <span class="at">-e</span> <span class="st">&#39;**Error&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Reminder to use formal admonitions instead of just bolding&quot;</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="ex">egp</span> <span class="at">-e</span> <span class="st">&#39;^[0-9]\. \*[^\*]&#39;</span> <span class="at">-e</span> <span class="st">&#39;^- \*[^\*][a-Z]&#39;</span> <span class="at">-e</span> <span class="st">&#39;^- \[.*\]\{\.smallcaps\}&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Reminder to use bold as the top level of emphasis in lists rather than italics or smallcaps&quot;</span></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>        <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-E</span> <span class="st">&#39;^title: &#39;</span>       <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">--char</span><span class="va">)</span><span class="st">&quot;</span> <span class="ot">-le</span> 10 <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&#39;\e[41mWARNING\e[0m: &quot;title:&quot; metadata too short.&#39;</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>        <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-E</span> <span class="st">&#39;^title: &#39;</span>       <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">--char</span><span class="va">)</span><span class="st">&quot;</span> <span class="ot">-ge</span> 60 <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&#39;\e[41mWARNING\e[0m: &quot;title:&quot; metadata too long.&#39;</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>        <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-E</span> <span class="st">&#39;^description: &#39;</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">--char</span><span class="va">)</span><span class="st">&quot;</span> <span class="ot">-le</span> 90 <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&#39;\e[41mWARNING\e[0m: &quot;description:&quot; metadata too short.&#39;</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>        <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-E</span> <span class="st">&#39;^description: &#39;</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">--char</span><span class="va">)</span><span class="st">&quot;</span> <span class="ot">-ge</span> 320 <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&#39;\e[41mWARNING\e[0m: &quot;description:&quot; metadata too long.&#39;</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>        <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-E</span> <span class="st">&#39;^next: &#39;</span>        <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">--char</span><span class="va">)</span><span class="st">&quot;</span> <span class="ot">-eq</span>  0 <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&#39;\e[41mWARNING\e[0m: &quot;next:&quot; metadata is missing.&#39;</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>        <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-E</span> <span class="st">&#39;^previous: &#39;</span>    <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">--char</span><span class="va">)</span><span class="st">&quot;</span> <span class="ot">-eq</span>  0 <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&#39;\e[41mWARNING\e[0m: &quot;previous:&quot; metadata is missing.&#39;</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>        <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-E</span> <span class="st">&#39;^thumbnail: &#39;</span>   <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">--char</span><span class="va">)</span><span class="st">&quot;</span> <span class="ot">-le</span> 20 <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&#39;\e[41mWARNING\e[0m: No thumbnail/illustration defined.&#39;</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>        <span class="co"># skip on newsletters since their URLs are always being modified:</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>        <span class="kw">[[</span> <span class="ot">!</span> <span class="va">$PAGE</span> <span class="ot">=~</span> <span class="st">&quot;newsletter/&quot;</span> <span class="kw">]]</span> <span class="kw">&amp;&amp;</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-E</span> <span class="st">&#39;^modified: 20&#39;</span>  <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">--char</span><span class="va">)</span><span class="st">&quot;</span> <span class="ot">-eq</span>  0 <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&#39;\e[41mWARNING\e[0m: &quot;modified:&quot; metadata is missing.&#39;</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="ex">markdown-length-checker.hs</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;}</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Source code line lengths&quot;</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="ex">markdown-footnote-length.hs</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Footnote lengths&quot;</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>        <span class="co"># proselint configuration is done in ~/.proselintrc; for Markdown, currently disabled: &quot;archaism.misc&quot; &quot;cursing.nfl&quot; &quot;links.broken&quot; &quot;misc.but&quot; &quot;misc.chat speak&quot; &quot;misc.phrasal_adjectives&quot; &quot;sexism.misc&quot; &quot;typography.diacritical_marks&quot; &quot;typography.exclamation&quot; &quot;typography.symbols&quot; &quot;typography.symbols.ellipsis&quot; &quot;typography.symbols.curly_quotes&quot;</span></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="ex">proselint</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Proselint nitpicks&quot;</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>        <span class="co">## reused later as well:</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>        <span class="va">HTML</span><span class="op">=</span><span class="va">$(</span><span class="fu">mktemp</span>  <span class="at">--suffix</span><span class="op">=</span><span class="st">&quot;.html&quot;</span><span class="va">)</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">pandoc</span> <span class="at">--metadata</span> lang=en <span class="at">--metadata</span> title=<span class="st">&quot;Test&quot;</span> <span class="at">--mathml</span> <span class="at">--to</span><span class="op">=</span>html5 <span class="at">--standalone</span> <span class="at">--number-sections</span> <span class="at">--toc</span> <span class="at">--reference-links</span> <span class="at">--css</span><span class="op">=</span>https://www.gwern.net/static/css/default.css <span class="at">-f</span> markdown+smart <span class="at">--template</span><span class="op">=</span>/home/gwern/bin/bin/pandoc-template-html5-articleedit.html5 <span class="at">-</span> <span class="at">--output</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$HTML</span><span class="st">&quot;</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="ex">tidy</span> <span class="at">-quiet</span> <span class="at">-errors</span> <span class="at">--doctype</span> html5 <span class="st">&quot;</span><span class="va">$HTML</span><span class="st">&quot;</span> <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="op">&gt;</span>/dev/null <span class="kw">|</span> <span class="fu">fgrep</span> <span class="at">-v</span> <span class="at">-e</span> <span class="st">&#39;Warning: &lt;img&gt; proprietary attribute &quot;loading&quot;&#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;HTML validation problems&quot;</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="fu">cat</span> <span class="st">&quot;</span><span class="va">$HTML</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">elinks</span> <span class="at">-dump</span> <span class="at">--force-html</span> <span class="kw">|</span> <span class="fu">egrep</span> <span class="st">&#39;file:///dev/stdin#.*\..*&#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Header problem: period present (valid HTML but breaks CSS/JS!). Override default Pandoc link fragment with &#39;{#header-without-period}&#39;&quot;</span></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span>  <span class="va">COLLAPSED</span><span class="op">=</span><span class="va">$(</span><span class="fu">cat</span> <span class="st">&quot;</span><span class="va">$HTML</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">egrep</span> <span class="at">--after-context</span><span class="op">=</span>3 <span class="st">&#39;&lt;h[0-7] class=&quot;collapse&quot;&#39;</span><span class="va">)</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>               <span class="va">COLLAPSED_SECTION_COUNT</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$COLLAPSED</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">egrep</span> <span class="st">&#39;&lt;h[0-7] class=&quot;collapse&quot;&#39;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">--lines</span><span class="va">)</span></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>               <span class="va">COLLAPSED_SUMMARY_COUNT</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$COLLAPSED</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">fgrep</span> <span class="st">&#39;&lt;div class=&quot;collapseSummary&quot;&gt;&#39;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">--lines</span><span class="va">)</span></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>               <span class="va">MISSING</span><span class="op">=</span><span class="va">$((</span> <span class="va">COLLAPSED_SECTION_COUNT</span> <span class="op">-</span> <span class="va">COLLAPSED_SUMMARY_COUNT</span> <span class="va">))</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>               <span class="cf">if</span> <span class="kw">[[</span> <span class="va">$MISSING</span> <span class="ot">!=</span> 0 <span class="kw">]];</span></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>               <span class="cf">then</span> <span class="bu">echo</span> <span class="st">&quot;Missing collapsed section summaries?&quot;</span></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">echo</span> <span class="st">&quot;Sections: </span><span class="va">$COLLAPSED_SECTION_COUNT</span><span class="st"> ; summaries: </span><span class="va">$COLLAPSED_SUMMARY_COUNT</span><span class="st">&quot;</span></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">echo</span> <span class="st">&quot;Hits: </span><span class="va">$COLLAPSED</span><span class="st">&quot;</span></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>               <span class="cf">fi</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Missing collapse summaries&quot;</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span>  <span class="ex">fgp</span> <span class="at">-e</span> <span class="st">&quot;&lt;&quot;&quot;del&quot;&quot;&gt;&quot;</span> <span class="st">&quot;</span><span class="va">$HTML</span><span class="st">&quot;</span><span class="kw">;</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>               <span class="ex">elinks</span> <span class="at">-dump</span> <span class="at">--force-html</span> <span class="st">&quot;</span><span class="va">$HTML</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">|</span> <span class="ex">fgp</span> <span class="at">-e</span> <span class="st">&#39;\frac&#39;</span> <span class="at">-e</span> <span class="st">&#39;\times&#39;</span> <span class="at">-e</span> <span class="st">&#39;(http&#39;</span> <span class="at">-e</span> <span class="st">&#39;)http&#39;</span> <span class="at">-e</span> <span class="st">&#39;[http&#39;</span> <span class="at">-e</span> <span class="st">&#39;]http&#39;</span>  <span class="dt">\</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>                        <span class="at">-e</span> <span class="st">&#39; _ &#39;</span> <span class="at">-e</span> <span class="st">&#39;[^&#39;</span> <span class="at">-e</span> <span class="st">&#39;^]&#39;</span> <span class="at">-e</span> <span class="st">&#39;/* &#39;</span> <span class="at">-e</span> <span class="st">&#39; */&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;!--&#39;</span> <span class="at">-e</span> <span class="st">&#39;--&gt;&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;-- &#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;—&#39;</span> <span class="at">-e</span> <span class="st">&#39;—&gt;&#39;</span> <span class="dt">\</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>                        <span class="at">-e</span> <span class="st">&#39;$title$&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;del&gt;&#39;</span> <span class="at">-e</span> <span class="st">&#39;.smallcaps&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;/q&lt;&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;q&gt;&#39;</span> <span class="at">-e</span> <span class="st">&#39;&lt;/q&gt;&#39;</span> <span class="dt">\</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>                        <span class="at">-e</span> <span class="st">&#39;$description$&#39;</span> <span class="at">-e</span> <span class="st">&#39;$author$&#39;</span> <span class="at">-e</span> <span class="st">&#39;$tags$&#39;</span> <span class="at">-e</span> <span class="st">&#39;$category$&#39;</span> <span class="dt">\</span></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>                        <span class="at">-e</span> <span class="st">&#39;(!Wikipedia&#39;</span> <span class="at">-e</span> <span class="st">&#39;(!Hoogle&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://www.gwern.net&#39;</span> <span class="at">-e</span> <span class="st">&#39;http://gwern.net&#39;</span> <span class="at">-e</span> <span class="st">&#39;smallcaps}&#39;</span> <span class="dt">\</span></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>                        <span class="at">-e</span> <span class="st">&#39;!Marin&#39;</span> <span class="at">-e</span> <span class="st">&#39;**&#39;</span>  <span class="dt">\</span></span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">|</span> <span class="ex">egp</span> <span class="at">-e</span> <span class="st">&#39;\!Margin:.*↩&#39;</span><span class="kw">;</span> <span class="kw">}</span> <span class="co"># ))</span></span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;look for syntax errors making it to the final HTML output&quot;</span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">runhaskell</span> <span class="at">-i</span>/home/gwern/wiki/static/build/ ~/wiki/static/build/link-extractor.hs <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">egrep</span> <span class="at">-v</span> <span class="at">-e</span> <span class="st">&quot;^http&quot;</span> <span class="at">-e</span> <span class="st">&#39;^!Wikipedia&#39;</span> <span class="at">-e</span> <span class="st">&#39;^#&#39;</span> <span class="at">-e</span> <span class="st">&#39;^/&#39;</span> <span class="at">-e</span> <span class="st">&#39;^\!&#39;</span> <span class="at">-e</span>  <span class="st">&#39;^\$&#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;special syntax shouldn&#39;t make it to the compiled HTML&quot;</span></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="ex">runhaskell</span> <span class="at">-i</span>/home/gwern/wiki/static/build/ ~/wiki/static/build/link-extractor.hs <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">egrep</span> <span class="at">-v</span> <span class="at">-e</span> <span class="st">&#39;^\!&#39;</span> <span class="at">-e</span>  <span class="st">&#39;^\$&#39;</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">|</span> <span class="fu">uniq</span> <span class="at">--count</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="at">--numeric-sort</span> <span class="kw">|</span> <span class="fu">egrep</span> <span class="at">-v</span> <span class="at">-e</span> <span class="st">&#39;.* 1 &#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Duplicate links&quot;</span></span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span><span class="kw">{</span> <span class="ex">egp</span> <span class="at">--only-matching</span> <span class="st">&#39;\!\[.*\]\(http://.*\)&#39;</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;image hotlinking deprecated; impolite, and slows page loads &amp; site compiles&quot;</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Note links which need to be annotated (probably most of them...)</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="ex">runhaskell</span> <span class="at">-i</span>/home/gwern/wiki/static/build/ ~/wiki/static/build/link-extractor.hs <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">egrep</span> <span class="at">-v</span> <span class="at">-e</span> <span class="st">&#39;^\!&#39;</span> <span class="at">-e</span> <span class="st">&#39;^\$&#39;</span> <span class="at">-e</span> <span class="st">&#39;^/docs/.*txt&#39;</span> <span class="at">-e</span> <span class="st">&#39;.xz$&#39;</span> <span class="at">-e</span> <span class="st">&#39;^#&#39;</span> <span class="at">-e</span> <span class="st">&#39;.patch$&#39;</span> <span class="at">-e</span> <span class="st">&#39;.jpg$&#39;</span> <span class="at">-e</span> <span class="st">&#39;.png$&#39;</span> <span class="at">-e</span> <span class="st">&#39;.mp4&#39;</span> <span class="at">-e</span> <span class="st">&#39;.mp3&#39;</span> <span class="at">-e</span> <span class="st">&#39;news.ycombinator.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;old.reddit.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;youtube.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;youtu.be/&#39;</span> <span class="at">-e</span> <span class="st">&#39;amazon.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;bandcamp.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;dropbox.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;vocadb.net&#39;</span> <span class="at">-e</span> <span class="st">&#39;twitter.com&#39;</span> <span class="at">-e</span> <span class="st">&#39;nitter.cc&#39;</span> <span class="at">-e</span> <span class="st">&#39;#link-bibliography&#39;</span> <span class="at">-e</span> <span class="st">&#39;https://en.wikipedia.org/wiki&#39;</span> <span class="kw">|</span> <span class="ex">runhaskell</span> <span class="at">-istatic</span>/build/ static/build/link-prioritize.hs<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Link annotations required&quot;</span></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>        <span class="co"># we use link annotations on URLs to warn readers about PDFs; if a URL ends in &#39;pdf&#39;, it gets a PDF icon. What about URLs which redirect to or serve PDF?</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>        <span class="co"># we must manually annotate them with a &#39;#pdf&#39;. Check URLs in a page for URLs which serve a PDF MIME type but do not mention PDF in their URL:</span></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="fu">checkPDF()</span> <span class="kw">{</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>                  <span class="va">MIME</span><span class="op">=</span><span class="va">$(</span><span class="ex">timeout</span> 20s curl <span class="at">--insecure</span> <span class="at">--write-out</span> <span class="st">&#39;%{content_type}&#39;</span> <span class="at">--silent</span> <span class="at">-o</span> /dev/null <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">fgrep</span> <span class="at">-i</span> <span class="at">-e</span> <span class="st">&quot;application/pdf&quot;</span> <span class="at">-e</span> <span class="st">&quot;application/octet-stream&quot;</span><span class="va">)</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> <span class="bu">[</span> <span class="va">${</span><span class="op">#</span><span class="va">MIME}</span> <span class="ot">-gt</span> 5 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">if</span> <span class="kw">[[</span> <span class="ot">!</span> <span class="va">$@</span> <span class="ot">=~</span> <span class="pp">.*</span><span class="ss">pdf</span><span class="pp">.*</span> <span class="kw">]]</span> <span class="kw">&amp;&amp;</span> <span class="kw">[[</span> <span class="ot">!</span> <span class="va">$@</span> <span class="ot">=~</span> <span class="pp">.*</span><span class="ss">PDF</span><span class="pp">.*</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>                          <span class="bu">echo</span> <span class="st">&quot;UNWARNED NON-LOCAL PDF: &quot;</span> <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$MIME</span><span class="st">&quot;</span></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">fi</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>                      <span class="bu">echo</span> <span class="st">&quot;NON-LOCAL PDF: </span><span class="va">$@</span><span class="st">&quot;</span></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">fi</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>              <span class="bu">export</span> <span class="at">-f</span> <span class="va">checkPDF</span></span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>              <span class="co"># examples: no/no/yes</span></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>              <span class="co">## checkPDF &#39;http://www.nytimes.com/2009/11/15/business/economy/15view.html &#39; # no</span></span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>              <span class="co">## checkPDF &#39;http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.208.2314&amp;rep=rep1&amp;type=pdf&#39; # yes</span></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>              <span class="co">## checkPDF &#39;https://files.osf.io/v1/resources/np2jd/providers/osfstorage/59614dec594d9002288271b6?action=download&amp;version=1&amp;direct&#39; # yes</span></span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>              <span class="ex">runhaskell</span> <span class="at">-i</span>/home/gwern/wiki/static/build/ ~/wiki/static/build/link-extractor.hs <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">egrep</span> <span class="st">&quot;^http&quot;</span> <span class="kw">|</span> <span class="fu">fgrep</span> <span class="at">-v</span> <span class="at">-e</span> <span class="st">&#39;https://www.gwern.net&#39;</span> <span class="at">-e</span> arxiv.org <span class="at">-e</span> pnas.org <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-u</span> <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">|</span> <span class="ex">parallel</span> <span class="at">-n</span> 1 checkPDF<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Non-icon/warned PDF links&quot;</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="cf">for</span> PDF <span class="kw">in</span> <span class="va">$(</span><span class="ex">runhaskell</span> <span class="at">-i</span>/home/gwern/wiki/static/build/ ~/wiki/static/build/link-extractor.hs <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">egrep</span> <span class="at">-e</span> <span class="st">&#39;^/docs/&#39;</span> <span class="at">-e</span> <span class="st">&#39;https:\/\/www\.gwern\.net\/&#39;</span> <span class="kw">|</span> <span class="dt">\</span></span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">egrep</span> <span class="st">&#39;\.pdf$&#39;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="at">-e</span> <span class="st">&#39;s/\/docs/docs/&#39;</span> <span class="at">-e</span> <span class="st">&#39;s/https:\/\/www\.gwern\.net//&#39;</span> <span class="va">)</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>                  <span class="va">TITLE</span><span class="op">=</span><span class="va">$(</span><span class="ex">exiftool</span> <span class="at">-printFormat</span> <span class="st">&#39;$Title&#39;</span> <span class="at">-Title</span> ~/wiki/<span class="st">&quot;</span><span class="va">$PDF</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>                  <span class="va">AUTHOR</span><span class="op">=</span><span class="va">$(</span><span class="ex">exiftool</span> <span class="at">-printFormat</span> <span class="st">&#39;$Author&#39;</span> <span class="at">-Author</span> ~/wiki/<span class="st">&quot;</span><span class="va">$PDF</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>                  <span class="va">DATE</span><span class="op">=</span><span class="va">$(</span><span class="ex">exiftool</span> <span class="at">-printFormat</span> <span class="st">&#39;$Date&#39;</span> <span class="at">-Date</span> ~/wiki/<span class="st">&quot;</span><span class="va">$PDF</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>                  <span class="va">DOI</span><span class="op">=</span><span class="va">$(</span><span class="ex">exiftool</span> <span class="at">-printFormat</span> <span class="st">&#39;$DOI&#39;</span> <span class="at">-DOI</span> ~/wiki/<span class="st">&quot;</span><span class="va">$PDF</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>                  <span class="va">TEXT</span><span class="op">=</span><span class="va">$(</span><span class="ex">pdftotext</span> ~/wiki/<span class="st">&quot;</span><span class="va">$PDF</span><span class="st">&quot;</span> <span class="at">-</span> <span class="dv">2</span><span class="op">&gt;</span>/dev/null<span class="va">)</span></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>                  <span class="va">TEXT_LENGTH</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$TEXT</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">--chars</span><span class="va">)</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>                  <span class="va">PREPRINT</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$TEXT</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">fgrep</span> <span class="at">-e</span> <span class="st">&#39;This is a PDF file of an unedited manuscript that has been accepted for publication.&#39;</span> <span class="dt">\</span></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">-e</span> <span class="st">&#39;use of the JSTOR database indicates your acceptance&#39;</span> <span class="dt">\</span></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">-e</span> <span class="st">&#39;you may not download an entire issue of a journal&#39;</span> <span class="dt">\</span></span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">-e</span> <span class="st">&#39;This article appeared in a journal published by Elsevier.&#39;</span> <span class="dt">\</span></span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">-e</span> <span class="st">&#39;institutional repository. Authors requiring further information&#39;</span> <span class="dt">\</span></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">-e</span> <span class="st">&#39;This article has been accepted for publication and undergone full peer review&#39;</span> <span class="dt">\</span></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">-e</span> <span class="st">&#39;the copyediting, typesetting, pagination and proofreading process&#39;</span> <span class="dt">\</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">-e</span> <span class="st">&#39;Changes resulting from the publishing process, including peer review,&#39;</span> <span class="dt">\</span></span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">-e</span> <span class="st">&#39;may lead to differences between this version and the Version of Record.&#39;</span> <span class="va">)</span></span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> <span class="kw">[[</span> <span class="ot">-n</span> <span class="st">&quot;</span><span class="va">$PREPRINT</span><span class="st">&quot;</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>                      <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$HOME</span><span class="st">/wiki/</span><span class="va">$PDF</span><span class="st">: preprint or front-page garbage (</span><span class="va">$PREPRINT</span><span class="st">)&quot;</span></span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">fi</span></span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> <span class="kw">((</span> <span class="va">$TEXT_LENGTH</span> <span class="op">&lt;</span> <span class="dv">1024</span> <span class="kw">));</span> <span class="cf">then</span></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>                      <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$HOME</span><span class="st">/wiki/</span><span class="va">$PDF</span><span class="st"> OCR text length: </span><span class="va">$TEXT_LENGTH</span><span class="st">&quot;</span></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">fi</span></span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> <span class="kw">[[</span> <span class="ot">-z</span> <span class="va">$TITLE</span> <span class="kw">||</span> <span class="ot">-z</span> <span class="va">$AUTHOR</span> <span class="kw">||</span> <span class="ot">-z</span> <span class="va">$DATE</span> <span class="kw">||</span> <span class="ot">-z</span> <span class="va">$DOI</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>                      <span class="ex">exiftool</span> <span class="at">-Title</span> <span class="at">-Author</span> <span class="at">-Date</span> <span class="at">-DOI</span> ~/wiki/<span class="st">&quot;</span><span class="va">$PDF</span><span class="st">&quot;</span></span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">fi</span></span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>              <span class="cf">done</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Linked PDFs have missing OCR or missing metadata fields&quot;</span></span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Finally, check for broken external links; ignore local URLs which are usually either relative links to</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>        <span class="co"># other pages in the repo or may be interwiki links like &#39;!Wikipedia&#39;.</span></span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>        <span class="fu">λ()</span> <span class="kw">{</span> <span class="ex">linkchecker</span> <span class="at">--no-status</span> <span class="at">--check-extern</span> <span class="at">--threads</span><span class="op">=</span>1 <span class="at">--timeout</span><span class="op">=</span>20 <span class="at">-r1</span> <span class="at">--ignore</span><span class="op">=</span><span class="st">&#39;file://.*&#39;</span> <span class="st">&quot;</span><span class="va">$HTML</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>        <span class="ex">wrap</span> λ <span class="st">&quot;Broken links&quot;</span></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="va">$PAGE</span> <span class="ot">==</span> <span class="pp">*</span>.sh <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>        <span class="ex">shellcheck</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span></span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="va">$PAGE</span> <span class="ot">==</span> <span class="pp">*</span>.hs <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>        <span class="ex">hlint</span> <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span></span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="va">$PAGE</span> <span class="ot">==</span> <span class="pp">*</span>.html <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>        <span class="ex">tidy</span> <span class="at">-quiet</span> <span class="at">-errors</span> <span class="at">--doctype</span> html5 <span class="st">&quot;</span><span class="va">$PAGE</span><span class="st">&quot;</span></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
